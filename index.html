<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rise of the 3-Point Shot in the NBA</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <div id="container">
    <h1>Rise of the 3-Point Shot in the NBA</h1>
    <div id="description"></div>
    <div id="vis"></div>
    <div id="controls">
      <button id="prevBtn">Previous</button>
      <button id="nextBtn">Next</button>
    </div>
  </div>

  <script>
    let sceneIndex = 0;
    let data = [];

    const width = 800, height = 500, margin = { top: 60, right: 50, bottom: 50, left: 70 };
    const svg = d3.select("#vis").append("svg")
      .attr("width", width)
      .attr("height", height);

    const scenes = [drawScene1, drawScene2, drawScene3];

    d3.csv("nba_3point_stats_cleaned.csv").then(csv => {
      data = csv;
      updateScene();
    });

    function updateScene() {
      svg.selectAll("*").remove();
      d3.select("#description").html("");
      scenes[sceneIndex]();
    }

    function drawScene1() {
      d3.select("#description").html("<h2>Scene 1: The Rise in Team 3-Point Attempts</h2><p>This line chart shows the average number of 3-point attempts per game per team over the years. You can see how teams began to heavily favor the 3-pointer, especially in the 2010s.</p>");

      const seasonAvg = d3.rollups(data, v => d3.mean(v, d => +d.team_3PA), d => d.season)
        .map(([season, avg3PA]) => ({ season, avg3PA }));

      seasonAvg.sort((a, b) => d3.ascending(a.season, b.season));

      const x = d3.scalePoint().domain(seasonAvg.map(d => d.season)).range([margin.left, width - margin.right]);
      const y = d3.scaleLinear().domain([0, d3.max(seasonAvg, d => d.avg3PA)]).nice().range([height - margin.bottom, margin.top]);

      const line = d3.line()
        .x(d => x(d.season))
        .y(d => y(d.avg3PA));

      svg.append("path")
        .datum(seasonAvg)
        .attr("fill", "none")
        .attr("stroke", "steelblue")
        .attr("stroke-width", 2)
        .attr("d", line);

      svg.append("g")
        .attr("transform", `translate(0,${height - margin.bottom})`)
        .call(d3.axisBottom(x).tickValues(seasonAvg.filter((d, i) => i % 5 === 0).map(d => d.season)).tickSizeOuter(0))
        .selectAll("text").attr("transform", "rotate(-45)").style("text-anchor", "end");

      svg.append("g")
        .attr("transform", `translate(${margin.left},0)`)
        .call(d3.axisLeft(y));

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .attr("font-size", "16px")
        .text("Average Team 3PA per Game by Season");

      svg.append("text")
        .attr("x", width - 220)
        .attr("y", y(seasonAvg[seasonAvg.length - 1].avg3PA) - 10)
        .text("3PA Rise")
        .attr("fill", "steelblue")
        .attr("font-weight", "bold");
    }

    function drawScene2() {
      d3.select("#description").html("<h2>Scene 2: Top 3-Point Shooters by Season</h2><p>In this bar chart, we highlight the top 3-point shooters for a specific year. Click below to cycle through seasons.</p>");
      const season = "2023-24";

      const players = data.filter(d => d.season === season);
      players.sort((a, b) => d3.descending(+a.player_3PM, +b.player_3PM));
      const top10 = players.slice(0, 10);

      const x = d3.scaleLinear().domain([0, d3.max(top10, d => +d.player_3PM)]).range([margin.left, width - margin.right]);
      const y = d3.scaleBand().domain(top10.map(d => d.player)).range([margin.top, height - margin.bottom]).padding(0.1);

      svg.selectAll("rect")
        .data(top10)
        .enter()
        .append("rect")
        .attr("x", margin.left)
        .attr("y", d => y(d.player))
        .attr("width", d => x(+d.player_3PM) - margin.left)
        .attr("height", y.bandwidth())
        .attr("fill", "#f28e2c");

      svg.append("g").attr("transform", `translate(0,${margin.top})`).call(d3.axisTop(x));
      svg.append("g").attr("transform", `translate(${margin.left},0)`).call(d3.axisLeft(y));

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .attr("font-size", "16px")
        .text(`Top 3PT Shooters in ${season}`);
    }

    function drawScene3() {
      d3.select("#description").html("<h2>Scene 3: Do More 3s Lead to More Wins?</h2><p>This scatterplot compares each team's average 3-point attempts to their win total in a selected season.</p>");

      const season = "2023-24";
      const seasonData = d3.groups(data, d => d.team).map(([team, values]) => {
        const entry = values.find(d => d.season === season);
        return entry ? { team: entry.team, team_3PA: +entry.team_3PA, wins: +entry.wins } : null;
      }).filter(d => d);

      const x = d3.scaleLinear().domain([0, d3.max(seasonData, d => d.team_3PA)]).nice().range([margin.left, width - margin.right]);
      const y = d3.scaleLinear().domain([0, d3.max(seasonData, d => d.wins)]).nice().range([height - margin.bottom, margin.top]);

      svg.selectAll("circle")
        .data(seasonData)
        .enter()
        .append("circle")
        .attr("cx", d => x(d.team_3PA))
        .attr("cy", d => y(d.wins))
        .attr("r", 5)
        .attr("fill", "#4e79a7");

      svg.append("g").attr("transform", `translate(0,${height - margin.bottom})`).call(d3.axisBottom(x));
      svg.append("g").attr("transform", `translate(${margin.left},0)`).call(d3.axisLeft(y));

      svg.append("text")
        .attr("x", width / 2)
        .attr("y", margin.top / 2)
        .attr("text-anchor", "middle")
        .attr("font-size", "16px")
        .text(`3PA vs Wins (${season})`);
    }

    d3.select("#prevBtn").on("click", () => {
      sceneIndex = (sceneIndex - 1 + scenes.length) % scenes.length;
      updateScene();
    });

    d3.select("#nextBtn").on("click", () => {
      sceneIndex = (sceneIndex + 1) % scenes.length;
      updateScene();
    });
  </script>
</body>
</html>
